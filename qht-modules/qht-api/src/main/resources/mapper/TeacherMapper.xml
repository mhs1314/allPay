<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.qht.mapper.TeacherMapper">

	<!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.qht.entity.Teacher" id="teacherMap">
        <result property="uid" column="uid"/>
        <result property="tenantId" column="tenant_id"/>
        <result property="schoolId" column="school_id"/>
        <result property="nickname" column="nickname"/>
        <result property="head" column="head"/>
        <result property="sex" column="sex"/>
        <result property="age" column="age"/>
        <result property="school" column="school"/>
        <result property="clazz" column="clazz"/>
        <result property="mobile" column="mobile"/>
        <result property="cert" column="cert"/>
        <result property="identityFace" column="identity_face"/>
        <result property="identityBack" column="identity_back"/>
        <result property="identityNum" column="identity_num"/>
        <result property="intr" column="intr"/>
        <result property="recommend" column="recommend"/>
        <result property="integral" column="integral"/>
        <result property="amount" column="amount"/>
        <result property="account" column="account"/>
        <result property="password" column="password"/>
    </resultMap>
    
    <!--登陆查询学生信息-->
    <select id="teacherLogin" resultType="com.qht.dto.TeacherDto">
        select uid,nickname,tenant_id as tenantId,school_id as schoolId from teacher where account=#{account} and password=#{password}
    </select>
    <!--名师详细-基本信息-->
    <select id="teacherDetails" resultType="com.qht.dto.TeacherDetailsDto">
        SELECT
	t.uid AS uid,
	t.intr as intr,
	AVG(l.comments_star) AS integral,
	sc.school_name as school_name,
	ps.`name`  as subject_name,
	t.nickname AS nickname,
	t.back_img AS back_img,
	t.praise_number AS praise_number
FROM
	teacher t
LEFT JOIN pkg_subject p ON t.subject_id = p.uid
LEFT JOIN lecturer_evaluation l ON t.uid = l.teacher_id
LEFT JOIN school sc   on t.school_id=sc.uid
LEFT JOIN pkg_subject ps ON t.subject_id=ps.uid
where t.uid=#{uid} and t.tenant_id=#{tid}
GROUP BY t.uid

    </select>
    <!--名师详细-所有课程包-->
    <select id="teacherCourse" resultType="com.qht.dto.AppTeacherCourseDto">
        SELECT
	c.cover AS cover,
	c.uid AS uid,
	c.pkg_name AS total_price,
	c.total_price AS total_price,
	c.apply_number AS apply_number,
	AVG(l.comments_star) / 2 AS integral,
	t.praise_number AS praise_number

FROM
	course_pkg c
LEFT JOIN teacher t ON c.teacher_id=t.uid
LEFT JOIN lecturer_evaluation l ON l.teacher_id=t.uid
where t.uid=#{uid} and t.tenant_id=#{tid}
GROUP BY c.uid

    </select>
</mapper>